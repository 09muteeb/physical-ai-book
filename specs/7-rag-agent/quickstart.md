# Quickstart: RAG Agent with OpenAI and FastAPI

## Prerequisites

- Python 3.8+
- OpenAI API key
- Qdrant database with existing embeddings
- Cohere API key (for retrieval functions)

## Setup

### 1. Install Dependencies

```bash
cd backend
pip install fastapi uvicorn[standard] openai==0.28.1 pydantic
```

### 2. Set Up Environment Variables

Create or update your `.env` file:

```env
OPENAI_API_KEY=your_openai_api_key_here
QDRANT_URL=your_qdrant_url_here
QDRANT_API_KEY=your_qdrant_api_key_here
COHERE_API_KEY=your_cohere_api_key_here
```

### 3. Ensure Qdrant Has Embeddings

Make sure your Qdrant instance has embeddings stored in the `rag_embedding` collection from the embedding pipeline:

```bash
# Run the embedding pipeline if needed
python main.py
```

## Running the RAG Agent

### Start the API Server

```bash
cd backend
uvicorn rag_agent:app --host 0.0.0.0 --port 8000 --reload
```

The API will be available at `http://localhost:8000`

## API Usage

### Health Check

Verify the service is running:

```bash
curl http://localhost:8000/health
```

Expected response:
```json
{
  "status": "healthy",
  "timestamp": "2025-12-19T15:30:00.123456",
  "services": {
    "api": "operational",
    "qdrant": "connected"
  }
}
```

### Query the RAG Agent

Send a query to get an answer based on retrieved context:

```bash
curl -X POST http://localhost:8000/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "What is Physical AI?",
    "max_results": 5,
    "similarity_threshold": 0.5
  }'
```

Expected response:
```json
{
  "query": "What is Physical AI?",
  "answer": "Physical AI is a field that combines artificial intelligence with physical systems...",
  "retrieved_chunks": [
    {
      "id": "chunk-id",
      "content": "Physical AI represents the integration of AI algorithms...",
      "source_url": "https://physical-ai-book-rose.vercel.app/...",
      "similarity_score": 0.85,
      "metadata": {
        "title": "Introduction to Physical AI",
        "created_at": "2025-12-19T10:30:00"
      }
    }
  ],
  "timestamp": "2025-12-19T15:30:00.123456",
  "sources": [
    "https://physical-ai-book-rose.vercel.app/introduction"
  ]
}
```

## Testing

### Run the Test Suite

```bash
python test_rag_agent.py
```

### Test the API Client

```bash
python api_client.py
```

## Configuration Options

### Query Parameters

- `query` (required): The question to answer
- `max_results` (optional, default: 5): Maximum number of context chunks to retrieve
- `similarity_threshold` (optional, default: 0.5): Minimum similarity score for results

### Environment Variables

- `OPENAI_API_KEY`: Required for OpenAI API access
- `QDRANT_URL`: Required for Qdrant database connection
- `QDRANT_API_KEY`: Required for Qdrant authentication
- `COHERE_API_KEY`: Required for Cohere embedding functions

## Troubleshooting

### Common Issues

**No results returned**:
- Verify Qdrant collection `rag_embedding` has data
- Check that embeddings were generated by the pipeline
- Verify Qdrant connection parameters

**OpenAI API errors**:
- Check that `OPENAI_API_KEY` is set correctly
- Verify API key has proper permissions
- Check for rate limiting

**Connection errors**:
- Verify all API endpoints are accessible
- Check firewall/network settings
- Ensure all required environment variables are set

### Health Check Issues

If health check shows services as disconnected:
- Verify Qdrant is running and accessible
- Check network connectivity to external services
- Validate all API keys are correct